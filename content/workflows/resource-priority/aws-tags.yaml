schema: 1.0
type: resource-priority
id: resource-priority-aws
name: tag based risk

filter:
  match-type: all
  rules:
    - |-
       .csp=="aws" and .canonicalId


risk-config:
  default-risk: ""
  rules:
    
    - name: dev enviornment risk is low
      condition: |-
        .getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("dev" ; "ix")))
      risk: low

    - name: prod enviornment risk is high
      condition: |-
        .getTags | any( select(.key | test("env" ; "ix")) | select(.value | test("prod" ; "ix")))
      risk: high

steps:
  - id: getTags
    uses: GetTags
    with:
      - name: arn
        value: .canonicalId
      - name: region
        value: .region


output:
  - name: environment
    value: first(.getTags[] | select(.key == "env") .value)
